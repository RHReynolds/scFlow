```{r results='asis', echo=FALSE}
if (plot_var == plot) {
  plot_caption <- sprintf(
    "<b>Figure: %s by individual sample (%s).</b>", 
    plot_var, metadata$merge_qc_params$unique_id_var)
} else {
  plot_caption <- sprintf(
    "<b>Figure: %s by %s.</b>", 
    plot_var, strsplit(plot, "_vs_")[[1]][[2]])
}
```

```{r results='asis', fig.align="center", fig.width=9, fig.height=4.5, fig.cap = plot_caption,  echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)

if (plot_var == plot) {
  cat("<div class=\"border border-dark rounded\">")
  cat(sprintf("<h2 class=\"display-3\">%s</h2>", plot_var))
} else {
  cat(sprintf("<h3>%s</h3>", plot))
}
print(metadata$merged_plots[[plot_var]][[plot]])
```

```{r results='asis', echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)

div(show_plot(print(formattable(
  metadata$merged_plots_data[[plot_var]][[plot]], 
                   list(
                     "mean" = color_bar("#71CA97"), 
                     "stdev_mean" = formatter("span", style = ~ style(color = "grey")),
                     "median" = color_bar("#71CA97"),
                     "mad" = formatter("span", style = ~ style(color = "grey"))
                     )
                 ))))
```

```{r results='asis', echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)

if (plot == tail(names(metadata$merged_plots[[plot_var]]), 1)) {
  cat("</div>")
}
```


